<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kasir App - Index</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

  <!-- Container Grid -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-11/12 md:w-8/12">
    <!-- Admin -->
    <div onclick="openLogin('admin')"
      class="bg-white rounded-2xl shadow-md p-8 text-center cursor-pointer hover:shadow-xl transition">
      <h2 class="text-2xl font-bold mb-4">Admin</h2>
      <p>Kelola akun, menu & lihat transaksi</p>
    </div>

    <!-- Kasir -->
    <div onclick="openLogin('kasir')"
      class="bg-white rounded-2xl shadow-md p-8 text-center cursor-pointer hover:shadow-xl transition">
      <h2 class="text-2xl font-bold mb-4">Kasir</h2>
      <p>Input penjualan harian</p>
    </div>

    <!-- Kas -->
    <div onclick="openLogin('kas')"
      class="bg-white rounded-2xl shadow-md p-8 text-center cursor-pointer hover:shadow-xl transition">
      <h2 class="text-2xl font-bold mb-4">Kas</h2>
      <p>Kelola kas awal & akhir</p>
    </div>
  </div>

  <!-- Popup Login -->
  <div id="loginModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white rounded-2xl shadow-lg w-96 p-6 relative">
      <h2 class="text-xl font-bold mb-4 text-center">Login</h2>
      <input id="username" type="text" placeholder="Username"
        class="w-full border rounded-lg px-3 py-2 mb-3 focus:outline-none focus:ring-2 focus:ring-blue-400">
      <input id="password" type="password" placeholder="Password"
        class="w-full border rounded-lg px-3 py-2 mb-4 focus:outline-none focus:ring-2 focus:ring-blue-400">
      <p id="errorMsg" class="text-red-500 text-sm mb-3 hidden"></p>
      <button onclick="handleLogin()"
        class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition">
        Login
      </button>
      <button onclick="closeLogin()"
        class="mt-3 w-full bg-gray-300 text-gray-800 py-2 rounded-lg hover:bg-gray-400 transition">
        Batal
      </button>
    </div>
  </div>

  <script>
    // Supabase config
    const SUPABASE_URL = "https://flrxlfxomfvcdjukedzd.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZscnhsZnhvbWZ2Y2RqdWtlZHpkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3MTkxNzUsImV4cCI6MjA3MjI5NTE3NX0.-zrx2JWMw03gDjLnrEa_WxQyiUOPdZ_WFYiE7VA1KhY";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    let selectedGrid = null;

    function openLogin(grid) {
      selectedGrid = grid;
      document.getElementById("loginModal").classList.remove("hidden");
      document.getElementById("errorMsg").classList.add("hidden");
      document.getElementById("username").value = "";
      document.getElementById("password").value = "";
    }

    function closeLogin() {
      document.getElementById("loginModal").classList.add("hidden");
    }

    async function handleLogin() {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();
      const errorMsg = document.getElementById("errorMsg");

      if (!username || !password) {
        errorMsg.textContent = "Harap isi username dan password.";
        errorMsg.classList.remove("hidden");
        return;
      }

      // Cek user di Supabase
      const { data, error } = await supabase
        .from("users")
        .select("*")
        .eq("username", username)
        .eq("password", password)
        .single();

      if (error || !data) {
        errorMsg.textContent = "Username atau password salah.";
        errorMsg.classList.remove("hidden");
        return;
      }

      const role = data.role;

      // Rule akses
      if (selectedGrid === "admin" && role === "admin") {
        window.location.href = "admin.html";
      } else if (selectedGrid === "kasir" && (role === "kasir" || role === "admin")) {
        window.location.href = "kasir.html";
      } else if (selectedGrid === "kas" && (role === "kasir" || role === "admin")) {
        window.location.href = "kas.html";
      } else {
        errorMsg.textContent = "Akses ditolak untuk role: " + role;
        errorMsg.classList.remove("hidden");
      }
    }
  </script>
</body>
</html>
