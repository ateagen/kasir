<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Admin - Bunda Ana</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
</head>
<body class="bg-gray-100 p-4">

  <div class="flex justify-between items-center mb-4">
    <h1 class="text-xl font-bold">Admin - Bunda Ana</h1>
    <a href="index.html" class="bg-gray-500 text-white px-3 py-1 rounded">Kembali</a>
  </div>

  <!-- Tambah Akun -->
  <div class="bg-white p-4 rounded shadow mb-4">
    <h2 class="font-semibold mb-2">Tambah Akun Kasir</h2>
    <input id="namaAkun" placeholder="Nama" class="border p-1 mb-2 w-full">
    <input id="passwordAkun" placeholder="Password" type="password" class="border p-1 mb-2 w-full">
    <button onclick="tambahAkun()" class="bg-blue-500 text-white px-3 py-1 rounded">Tambah</button>
  </div>

  <!-- Daftar Akun -->
  <div class="bg-white p-4 rounded shadow mb-4">
    <h2 class="font-semibold mb-2">Daftar Akun</h2>
    <ul id="daftarAkun"></ul>
  </div>

  <!-- Tambah Menu -->
  <div class="bg-white p-4 rounded shadow mb-4">
    <h2 class="font-semibold mb-2">Tambah Menu</h2>
    <input id="namaMenu" placeholder="Nama Menu" class="border p-1 mb-2 w-full">
    <input id="hargaMenu" placeholder="Harga" type="number" class="border p-1 mb-2 w-full">
    <button onclick="tambahMenu()" class="bg-green-500 text-white px-3 py-1 rounded">Tambah</button>
  </div>

  <!-- Daftar Menu -->
  <div class="bg-white p-4 rounded shadow mb-4">
    <h2 class="font-semibold mb-2">Daftar Menu</h2>
    <ul id="daftarMenu"></ul>
  </div>

  <!-- Transaksi -->
  <div class="bg-white p-4 rounded shadow">
    <h2 class="font-semibold mb-2">Transaksi</h2>
    <table class="w-full border">
      <thead>
        <tr class="bg-gray-200">
          <th class="border p-1">Tanggal</th>
          <th class="border p-1">Kasir</th>
          <th class="border p-1">Total</th>
          <th class="border p-1">Bayar</th>
          <th class="border p-1">Kembalian</th>
        </tr>
      </thead>
      <tbody id="tabelTransaksi"></tbody>
    </table>
  </div>

<script>
  const SUPABASE_URL = "https://flrxlfxomfvcdjukedzd.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZscnhsZnhvbWZ2Y2RqdWtlZHpkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3MTkxNzUsImV4cCI6MjA3MjI5NTE3NX0.-zrx2JWMw03gDjLnrEa_WxQyiUOPdZ_WFYiE7VA1KhY";
  const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  // Akun
  async function loadAkun() {
    let { data, error } = await supabaseClient.from("akun").select("*");
    if (error) return console.error(error);
    const daftar = document.getElementById("daftarAkun");
    daftar.innerHTML = "";
    data.forEach(a => {
      let li = document.createElement("li");
      li.className = "flex justify-between border p-1 mb-1";
      li.innerHTML = `${a.nama} <button onclick="hapusAkun('${a.id}')" class="bg-red-500 text-white px-2 rounded">Hapus</button>`;
      daftar.appendChild(li);
    });
  }
  async function tambahAkun() {
    const nama = document.getElementById("namaAkun").value;
    const password = document.getElementById("passwordAkun").value;
    let { error } = await supabaseClient.from("akun").insert([{ nama, password }]);
    if (error) alert("Gagal tambah akun"); else loadAkun();
  }
  async function hapusAkun(id) {
    await supabaseClient.from("akun").delete().eq("id", id);
    loadAkun();
  }

  // Menu
  async function loadMenu() {
    let { data, error } = await supabaseClient.from("menu").select("*");
    if (error) return console.error(error);
    const daftar = document.getElementById("daftarMenu");
    daftar.innerHTML = "";
    data.forEach(m => {
      let li = document.createElement("li");
      li.className = "flex justify-between border p-1 mb-1";
      li.innerHTML = `${m.nama} - Rp ${m.harga} <button onclick="hapusMenu('${m.id}')" class="bg-red-500 text-white px-2 rounded">Hapus</button>`;
      daftar.appendChild(li);
    });
  }
  async function tambahMenu() {
    const nama = document.getElementById("namaMenu").value;
    const harga = parseInt(document.getElementById("hargaMenu").value);
    let { error } = await supabaseClient.from("menu").insert([{ nama, harga }]);
    if (error) alert("Gagal tambah menu"); else loadMenu();
  }
  async function hapusMenu(id) {
    await supabaseClient.from("menu").delete().eq("id", id);
    loadMenu();
  }

  // Transaksi
  async function loadTransaksi() {
    let { data, error } = await supabaseClient
      .from("transaksi")
      .select("id, total, bayar, kembalian, created_at, akun(nama)")
      .order("created_at", { ascending: false });

    if (error) {
      alert("Gagal load transaksi: " + error.message);
      return;
    }

    const tbody = document.getElementById("tabelTransaksi");
    tbody.innerHTML = "";
    data.forEach(t => {
      let tr = document.createElement("tr");
      tr.innerHTML = `
        <td class="border p-1">${new Date(t.created_at).toLocaleString()}</td>
        <td class="border p-1">${t.akun ? t.akun.nama : "-"}</td>
        <td class="border p-1">Rp ${t.total}</td>
        <td class="border p-1">Rp ${t.bayar}</td>
        <td class="border p-1">Rp ${t.kembalian}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  loadAkun();
  loadMenu();
  loadTransaksi();
</script>

</body>
</html>
