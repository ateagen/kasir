<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Admin Kasir</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">

  <!-- Login Admin -->
  <div id="loginPage" class="w-full max-w-sm bg-white rounded-2xl shadow p-6">
    <h2 class="text-xl font-bold mb-4">Login Admin</h2>
    <input id="adminUser" type="text" placeholder="Username"
      class="w-full border p-2 rounded mb-2">
    <input id="adminPass" type="password" placeholder="Password"
      class="w-full border p-2 rounded mb-4">
    <button onclick="adminLogin()" class="w-full bg-indigo-600 text-white py-2 rounded">Login</button>
    <p class="text-sm text-gray-500 mt-2">Default: admin / admin</p>
  </div>

  <!-- Halaman Admin -->
  <div id="adminPage" class="hidden w-full max-w-5xl bg-white rounded-2xl shadow p-6">
    <h1 class="text-2xl font-bold mb-6">Halaman Admin</h1>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      
      <!-- Kasir -->
      <div>
        <h2 class="text-lg font-semibold mb-2">Manajemen Kasir</h2>
        <div class="flex gap-2 mb-2">
          <input id="kasirName" placeholder="Nama Kasir" class="border p-2 rounded flex-1">
          <input id="kasirPass" type="password" placeholder="Password" class="border p-2 rounded flex-1">
          <button onclick="addKasir()" class="bg-green-600 text-white px-3 rounded">Tambah</button>
        </div>
        <ul id="kasirList" class="space-y-2"></ul>
      </div>

      <!-- Menu -->
      <div>
        <h2 class="text-lg font-semibold mb-2">Manajemen Menu</h2>
        <div class="flex gap-2 mb-2">
          <input id="menuName" placeholder="Nama Menu" class="border p-2 rounded flex-1">
          <input id="menuPrice" type="number" placeholder="Harga" class="border p-2 rounded w-32">
          <button onclick="addMenu()" class="bg-green-600 text-white px-3 rounded">Tambah</button>
        </div>
        <ul id="menuList" class="space-y-2"></ul>
      </div>
    </div>

    <div class="mt-6">
      <button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded">Logout</button>
    </div>
  </div>

  <!-- Popup Loading -->
  <div id="loadingPopup" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-40">
    <div class="bg-white p-6 rounded-xl shadow-lg flex flex-col items-center">
      <div class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-indigo-600"></div>
      <p class="mt-3 text-gray-700">Menyimpan...</p>
    </div>
  </div>

<script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyNWXKPM9tuGjwS7YLvNEoxV0CYoVYeEPEqvWqmBcAVi_SqnEFvXPXpLvppJOg68Ps/exec"; // ganti dengan URL Web App

  // Login
  function adminLogin() {
    const u = document.getElementById("adminUser").value;
    const p = document.getElementById("adminPass").value;
    if (u === "admin" && p === "admin") {
      document.getElementById("loginPage").classList.add("hidden");
      document.getElementById("adminPage").classList.remove("hidden");
      loadKasir();
      loadMenu();
    } else {
      alert("Username/Password salah!");
    }
  }

  function logout() {
    document.getElementById("adminPage").classList.add("hidden");
    document.getElementById("loginPage").classList.remove("hidden");
  }

  // Loading
  function showLoading(callback) {
    const popup = document.getElementById("loadingPopup");
    popup.classList.remove("hidden");
    setTimeout(() => {
      popup.classList.add("hidden");
      if (callback) callback();
    }, 1000);
  }

  // === Kasir ===
  async function loadKasir() {
    const res = await fetch(`${SCRIPT_URL}?sheet=Kasir`);
    const data = await res.json();
    const list = document.getElementById("kasirList");
    list.innerHTML = "";
    data.forEach(k => {
      const li = document.createElement("li");
      li.className = "flex justify-between items-center border p-2 rounded";
      li.innerHTML = `<div>${k.Nama}</div>
        <button onclick="deleteKasir('${k.Nama}')" class="bg-red-500 text-white px-2 py-1 rounded">Hapus</button>`;
      list.appendChild(li);
    });
  }

  async function addKasir() {
    const name = document.getElementById("kasirName").value.trim();
    const pass = document.getElementById("kasirPass").value.trim();
    if (!name || !pass) return alert("Isi semua data kasir!");

    showLoading(async () => {
      await fetch(`${SCRIPT_URL}?sheet=Kasir&action=add`, {
        method: "POST",
        body: JSON.stringify({Nama: name, Password: pass}),
      });
      loadKasir();
      document.getElementById("kasirName").value="";
      document.getElementById("kasirPass").value="";
    });
  }

  async function deleteKasir(name) {
    showLoading(async () => {
      await fetch(`${SCRIPT_URL}?sheet=Kasir&action=delete&key=${encodeURIComponent(name)}`, {
        method: "POST",
      });
      loadKasir();
    });
  }

  // === Menu ===
  async function loadMenu() {
    const res = await fetch(`${SCRIPT_URL}?sheet=Menu`);
    const data = await res.json();
    const list = document.getElementById("menuList");
    list.innerHTML = "";
    data.forEach(m => {
      const li = document.createElement("li");
      li.className = "flex justify-between items-center border p-2 rounded";
      li.innerHTML = `<div>${m.Nama} - Rp${m.Harga}</div>
        <button onclick="deleteMenu('${m.Nama}')" class="bg-red-500 text-white px-2 py-1 rounded">Hapus</button>`;
      list.appendChild(li);
    });
  }

  async function addMenu() {
    const name = document.getElementById("menuName").value.trim();
    const price = document.getElementById("menuPrice").value.trim();
    if (!name || !price) return alert("Isi semua data menu!");

    showLoading(async () => {
      await fetch(`${SCRIPT_URL}?sheet=Menu&action=add`, {
        method: "POST",
        body: JSON.stringify({Nama: name, Harga: price}),
      });
      loadMenu();
      document.getElementById("menuName").value="";
      document.getElementById("menuPrice").value="";
    });
  }

  async function deleteMenu(name) {
    showLoading(async () => {
      await fetch(`${SCRIPT_URL}?sheet=Menu&action=delete&key=${encodeURIComponent(name)}`, {
        method: "POST",
      });
      loadMenu();
    });
  }
</script>
</body>
</html>
