<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin POS</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="loading">Loading...</div>

<div class="modal" id="loginModal">
  <div class="modal-content">
    <h3>Login Admin/Kasir</h3>
    <input type="text" id="loginUsername" placeholder="Username"><br>
    <input type="password" id="loginPassword" placeholder="Password"><br>
    <button id="loginBtn">Login</button>
  </div>
</div>

<header>
  <h1>Admin POS</h1>
  <button id="logoutBtn">Logout</button>
</header>

<main>
  <!-- Sidebar akun -->
  <aside>
    <h3>Akun</h3>
    <input type="text" id="newUsername" placeholder="Username">
    <input type="password" id="newPassword" placeholder="Password">
    <select id="newRole">
      <option value="admin">Admin</option>
      <option value="kasir">Kasir</option>
    </select>
    <button id="addAkunBtn">Tambah Akun</button>
    <table id="akunTable">
      <thead><tr><th>Username</th><th>Role</th><th>Aksi</th></tr></thead>
      <tbody></tbody>
    </table>
  </aside>

  <!-- Menu -->
  <section>
    <h3>Menu</h3>
    <input type="text" id="menuNama" placeholder="Nama Menu">
    <input type="number" id="menuHarga" placeholder="Harga">
    <select id="menuKategori">
      <option value="Makanan">Makanan</option>
      <option value="Minuman">Minuman</option>
      <option value="Cemilan">Cemilan</option>
    </select>
    <button id="addMenuBtn">Tambah Menu</button>
    <table id="menuTable">
      <thead><tr><th>Nama</th><th>Harga</th><th>Kategori</th><th>Aksi</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Transaksi -->
  <aside>
    <h3>Transaksi</h3>
    <button id="refreshTransaksiBtn">Refresh Transaksi</button>
    <table id="transaksiTable">
      <thead>
        <tr><th>ID</th><th>Tanggal</th><th>Kasir</th><th>Menu</th><th>Keterangan</th><th>Jumlah</th><th>Harga</th><th>Debit</th><th>Kredit</th><th>Aksi</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <button id="openKasirBtn">Buka Kasir</button>
  </aside>
</main>

<script>
const apiUrl = 'https://script.google.com/macros/s/AKfycbyTh7GmIHn45Lq58gnQuT-ebKZtn9HARFIFIKzb9NxIvjd7a34qRYeCoLbqs_UzxBjd/exec';
let sessionUser = JSON.parse(localStorage.getItem('adminSession')) || null;

function showLogin(){
  document.getElementById('loginModal').style.display='block';
}

function doLogin(){
  const user = document.getElementById('loginUsername').value;
  const pw = document.getElementById('loginPassword').value;
  fetch(apiUrl,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({action:'login',username:user,password:pw})
  }).then(r=>r.json()).then(res=>{
    if(res.status=='success'){
      sessionUser = {username:res.username, role:res.role};
      localStorage.setItem('adminSession',JSON.stringify(sessionUser));
      document.getElementById('loginModal').style.display='none';
      alert('Login berhasil! Role: '+res.role);
    } else {
      alert('Login gagal: '+res.message);
    }
  }).catch(err=>{
    alert('Fetch error, pastikan jalankan dari server (localhost/GitHub Pages).');
  });
}

function logout(){
  localStorage.removeItem('adminSession');
  sessionUser=null;
  showLogin();
}

function openKasir(){
  if(sessionUser && (sessionUser.role=='admin'||sessionUser.role=='kasir')){
    window.open('kasir.html','_blank');
  } else alert('Hanya admin/kasir yang bisa akses kasir!');
}

document.getElementById('loginBtn').addEventListener('click',doLogin);
document.getElementById('logoutBtn').addEventListener('click',logout);
document.getElementById('openKasirBtn').addEventListener('click',openKasir);

if(!sessionUser) showLogin();
</script>
</body>
</html>
