<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">

  <!-- Login Page -->
  <div id="loginPage" class="w-full max-w-md bg-white p-6 rounded-xl shadow-lg">
    <h2 class="text-2xl font-bold mb-4 text-center">Login Admin</h2>
    <input id="username" type="text" placeholder="Username"
      class="w-full border px-3 py-2 mb-3 rounded-lg focus:outline-none focus:ring">
    <input id="password" type="password" placeholder="Password"
      class="w-full border px-3 py-2 mb-3 rounded-lg focus:outline-none focus:ring">
    <button onclick="login()"
      class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600">Login</button>
  </div>

  <!-- Admin Dashboard -->
  <div id="adminPage" class="hidden w-full p-6">
    <h1 class="text-3xl font-bold mb-6">Admin Dashboard</h1>

    <!-- Akun Section -->
    <div class="mb-8 bg-white p-6 rounded-xl shadow-md">
      <h2 class="text-xl font-semibold mb-4">Kelola Akun</h2>
      <div class="flex space-x-2 mb-4">
        <input id="newUser" type="text" placeholder="Username" class="border px-3 py-2 rounded-lg flex-1">
        <input id="newPass" type="password" placeholder="Password" class="border px-3 py-2 rounded-lg flex-1">
        <button onclick="tambahAkun()" class="bg-green-500 text-white px-4 rounded-lg hover:bg-green-600">Tambah</button>
      </div>
      <ul id="akunList" class="list-disc pl-6"></ul>
    </div>

    <!-- Menu Section -->
    <div class="mb-8 bg-white p-6 rounded-xl shadow-md">
      <h2 class="text-xl font-semibold mb-4">Kelola Menu</h2>
      <div class="flex space-x-2 mb-4">
        <input id="newMenu" type="text" placeholder="Nama Menu" class="border px-3 py-2 rounded-lg flex-1">
        <input id="newHarga" type="number" placeholder="Harga" class="border px-3 py-2 rounded-lg flex-1">
        <button onclick="tambahMenu()" class="bg-green-500 text-white px-4 rounded-lg hover:bg-green-600">Tambah</button>
      </div>
      <ul id="menuList" class="list-disc pl-6"></ul>
    </div>

    <!-- Transaksi Section -->
    <div class="bg-white p-6 rounded-xl shadow-md">
      <h2 class="text-xl font-semibold mb-4">Transaksi</h2>
      <div class="flex items-center space-x-2 mb-4">
        <input type="date" id="filterTanggal" class="border px-3 py-2 rounded-lg">
        <button onclick="getTransaksi()" class="bg-blue-500 text-white px-4 rounded-lg hover:bg-blue-600">Filter</button>
      </div>
      <table class="w-full border-collapse border text-sm">
        <thead>
          <tr class="bg-gray-200">
            <th class="border px-2 py-1">Tanggal</th>
            <th class="border px-2 py-1">Username</th>
            <th class="border px-2 py-1">Menu</th>
            <th class="border px-2 py-1">Harga</th>
            <th class="border px-2 py-1">Jumlah</th>
            <th class="border px-2 py-1">Total</th>
          </tr>
        </thead>
        <tbody id="transaksiTable"></tbody>
      </table>
    </div>
  </div>

  <!-- Loading Popup -->
  <div id="loadingPopup" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white p-6 rounded-xl shadow-lg">
      <p class="text-lg font-semibold">Loading...</p>
    </div>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbzSETZz3UiD0GoDiwpsuaiHEBezbBWNuoQJAyo5JP7DCev1YkgsdtjeXHW5lihHxeR6/exec";

    // === Login ===
    function login() {
      const user = document.getElementById("username").value;
      const pass = document.getElementById("password").value;
      if (user === "admin" && pass === "admin1490") {
        document.getElementById("loginPage").classList.add("hidden");
        document.getElementById("adminPage").classList.remove("hidden");
        loadAkun();
        loadMenu();
        todayTanggal();
        getTransaksi();
      } else {
        alert("Login gagal");
      }
    }

    // === Loading ===
    function showLoading(show = true) {
      document.getElementById("loadingPopup").classList.toggle("hidden", !show);
    }

    // === Akun ===
    async function loadAkun() {
      showLoading(true);
      const res = await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "getAkun" })
      });
      const data = await res.json();
      const list = document.getElementById("akunList");
      list.innerHTML = "";
      data.data.forEach(acc => {
        const li = document.createElement("li");
        li.textContent = acc.username + " ";
        const btn = document.createElement("button");
        btn.textContent = "Hapus";
        btn.className = "ml-2 text-red-500";
        btn.onclick = () => hapusAkun(acc.username);
        li.appendChild(btn);
        list.appendChild(li);
      });
      showLoading(false);
    }

    async function tambahAkun() {
      const user = document.getElementById("newUser").value;
      const pass = document.getElementById("newPass").value;
      if (!user || !pass) return alert("Isi semua field!");
      showLoading(true);
      await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "tambahAkun", username: user, password: pass })
      });
      await loadAkun();
    }

    async function hapusAkun(user) {
      showLoading(true);
      await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "hapusAkun", username: user })
      });
      await loadAkun();
    }

    // === Menu ===
    async function loadMenu() {
      showLoading(true);
      const res = await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "getMenu" })
      });
      const data = await res.json();
      const list = document.getElementById("menuList");
      list.innerHTML = "";
      data.data.forEach(menu => {
        const li = document.createElement("li");
        li.textContent = menu.namaMenu + " - Rp" + menu.harga;
        const btn = document.createElement("button");
        btn.textContent = "Hapus";
        btn.className = "ml-2 text-red-500";
        btn.onclick = () => hapusMenu(menu.namaMenu);
        li.appendChild(btn);
        list.appendChild(li);
      });
      showLoading(false);
    }

    async function tambahMenu() {
      const nama = document.getElementById("newMenu").value;
      const harga = document.getElementById("newHarga").value;
      if (!nama || !harga) return alert("Isi semua field!");
      showLoading(true);
      await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "tambahMenu", namaMenu: nama, harga: harga })
      });
      await loadMenu();
    }

    async function hapusMenu(nama) {
      showLoading(true);
      await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "hapusMenu", namaMenu: nama })
      });
      await loadMenu();
    }

    // === Transaksi ===
    function todayTanggal() {
      const today = new Date().toISOString().split("T")[0];
      document.getElementById("filterTanggal").value = today;
    }

    async function getTransaksi() {
      const tanggal = document.getElementById("filterTanggal").value;
      showLoading(true);
      const res = await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "getTransaksi", tanggal })
      });
      const data = await res.json();
      const tbody = document.getElementById("transaksiTable");
      tbody.innerHTML = "";
      data.data.forEach(trx => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="border px-2 py-1">${new Date(trx.tanggal).toLocaleString()}</td>
          <td class="border px-2 py-1">${trx.username}</td>
          <td class="border px-2 py-1">${trx.namaMenu}</td>
          <td class="border px-2 py-1">${trx.harga}</td>
          <td class="border px-2 py-1">${trx.jumlah}</td>
          <td class="border px-2 py-1">${trx.total}</td>
        `;
        tbody.appendChild(tr);
      });
      showLoading(false);
    }
  </script>
</body>
</html>
