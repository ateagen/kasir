<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">

  <!-- Login Form -->
  <div id="loginForm" class="w-full max-w-sm p-6 bg-white rounded-2xl shadow-lg">
    <h2 class="text-2xl font-bold text-center mb-6">Login Admin</h2>
    <input id="username" type="text" placeholder="Username" class="w-full mb-3 px-4 py-2 border rounded-lg focus:outline-none focus:ring focus:border-blue-300">
    <input id="password" type="password" placeholder="Password" class="w-full mb-4 px-4 py-2 border rounded-lg focus:outline-none focus:ring focus:border-blue-300">
    <button onclick="loginAdmin()" class="w-full bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">Login</button>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="hidden w-full max-w-6xl p-6 bg-white rounded-2xl shadow-lg">
    <h2 class="text-2xl font-bold mb-6">Admin Dashboard</h2>

    <!-- Akun Section -->
    <div class="mb-8">
      <h3 class="text-xl font-semibold mb-4">Kelola Akun</h3>
      <div class="flex gap-2 mb-4">
        <input id="newUsername" type="text" placeholder="Username" class="flex-1 px-4 py-2 border rounded-lg">
        <input id="newPassword" type="text" placeholder="Password" class="flex-1 px-4 py-2 border rounded-lg">
        <button onclick="tambahAkun()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600">Tambah</button>
      </div>
      <table class="w-full text-left border">
        <thead>
          <tr class="bg-gray-200">
            <th class="px-3 py-2">Username</th>
            <th class="px-3 py-2">Password</th>
            <th class="px-3 py-2">Aksi</th>
          </tr>
        </thead>
        <tbody id="akunList"></tbody>
      </table>
    </div>

    <!-- Menu Section -->
    <div class="mb-8">
      <h3 class="text-xl font-semibold mb-4">Kelola Menu</h3>
      <div class="flex gap-2 mb-4">
        <input id="menuName" type="text" placeholder="Nama Menu" class="flex-1 px-4 py-2 border rounded-lg">
        <input id="menuPrice" type="number" placeholder="Harga" class="flex-1 px-4 py-2 border rounded-lg">
        <button onclick="tambahMenu()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600">Tambah</button>
      </div>
      <table class="w-full text-left border">
        <thead>
          <tr class="bg-gray-200">
            <th class="px-3 py-2">Menu</th>
            <th class="px-3 py-2">Harga</th>
            <th class="px-3 py-2">Aksi</th>
          </tr>
        </thead>
        <tbody id="menuList"></tbody>
      </table>
    </div>

    <!-- Transaksi Section -->
    <div>
      <h3 class="text-xl font-semibold mb-4">Transaksi</h3>
      <div class="flex items-center gap-2 mb-4">
        <input id="filterTanggal" type="date" class="px-4 py-2 border rounded-lg">
        <button onclick="filterTransaksi()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">Filter</button>
      </div>
      <table class="w-full text-left border">
        <thead>
          <tr class="bg-gray-200">
            <th class="px-3 py-2">Tanggal</th>
            <th class="px-3 py-2">Kasir</th>
            <th class="px-3 py-2">Menu</th>
            <th class="px-3 py-2">Harga</th>
            <th class="px-3 py-2">Jumlah</th>
            <th class="px-3 py-2">Total</th>
          </tr>
        </thead>
        <tbody id="transaksiList"></tbody>
      </table>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loading" class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center z-50">
    <div class="bg-white px-6 py-4 rounded-lg shadow-lg">Loading...</div>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxJKwYJ8MvMmyoYiuI4xfcMlMRfTIzpsZjJNMKtyyRb9ODFcDqWy8RWrob83gnToDGL/exec";

    // Loading
    function showLoading() { document.getElementById("loading").style.display = "flex"; }
    function hideLoading() { document.getElementById("loading").style.display = "none"; }

    // Login Admin
    async function loginAdmin() {
      showLoading();
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      const res = await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "login", username, password }),
        headers: { "Content-Type": "application/json" }
      });
      const data = await res.json();
      hideLoading();

      if (data.status === "success" && username === "admin") {
        document.getElementById("loginForm").classList.add("hidden");
        document.getElementById("dashboard").classList.remove("hidden");
        loadAkun();
        loadMenu();
        loadTransaksiHariIni();
      } else {
        alert("Login gagal!");
      }
    }

    // ============== Akun ==============
    async function loadAkun() {
      showLoading();
      const res = await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "getAkun" }),
        headers: { "Content-Type": "application/json" }
      });
      const data = await res.json();
      hideLoading();

      const tbody = document.getElementById("akunList");
      tbody.innerHTML = "";
      data.akun.forEach(a => {
        tbody.innerHTML += `
          <tr>
            <td class="px-3 py-2">${a.username}</td>
            <td class="px-3 py-2">${a.password}</td>
            <td class="px-3 py-2">
              <button onclick="hapusAkun('${a.username}')" class="bg-red-500 text-white px-3 py-1 rounded">Hapus</button>
            </td>
          </tr>`;
      });
    }

    async function tambahAkun() {
      const username = document.getElementById("newUsername").value;
      const password = document.getElementById("newPassword").value;
      showLoading();
      await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "tambahAkun", username, password }),
        headers: { "Content-Type": "application/json" }
      });
      hideLoading();
      loadAkun();
    }

    async function hapusAkun(username) {
      showLoading();
      await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "hapusAkun", username }),
        headers: { "Content-Type": "application/json" }
      });
      hideLoading();
      loadAkun();
    }

    // ============== Menu ==============
    async function loadMenu() {
      showLoading();
      const res = await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "getMenu" }),
        headers: { "Content-Type": "application/json" }
      });
      const data = await res.json();
      hideLoading();

      const tbody = document.getElementById("menuList");
      tbody.innerHTML = "";
      data.menu.forEach(m => {
        tbody.innerHTML += `
          <tr>
            <td class="px-3 py-2">${m.namaMenu}</td>
            <td class="px-3 py-2">${m.harga}</td>
            <td class="px-3 py-2">
              <button onclick="hapusMenu('${m.namaMenu}')" class="bg-red-500 text-white px-3 py-1 rounded">Hapus</button>
            </td>
          </tr>`;
      });
    }

    async function tambahMenu() {
      const namaMenu = document.getElementById("menuName").value;
      const harga = document.getElementById("menuPrice").value;
      showLoading();
      await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "tambahMenu", namaMenu, harga }),
        headers: { "Content-Type": "application/json" }
      });
      hideLoading();
      loadMenu();
    }

    async function hapusMenu(namaMenu) {
      showLoading();
      await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "hapusMenu", namaMenu }),
        headers: { "Content-Type": "application/json" }
      });
      hideLoading();
      loadMenu();
    }

    // ============== Transaksi ==============
    async function loadTransaksiHariIni() {
      const today = new Date().toISOString().split("T")[0];
      loadTransaksi(today);
    }

    async function filterTransaksi() {
      const tanggal = document.getElementById("filterTanggal").value;
      if (tanggal) loadTransaksi(tanggal);
    }

    async function loadTransaksi(tanggal) {
      showLoading();
      const res = await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "getTransaksi", tanggal }),
        headers: { "Content-Type": "application/json" }
      });
      const data = await res.json();
      hideLoading();

      const tbody = document.getElementById("transaksiList");
      tbody.innerHTML = "";
      data.transaksi.forEach(t => {
        tbody.innerHTML += `
          <tr>
            <td class="px-3 py-2">${t.tanggal}</td>
            <td class="px-3 py-2">${t.username}</td>
            <td class="px-3 py-2">${t.menu}</td>
            <td class="px-3 py-2">${t.harga}</td>
            <td class="px-3 py-2">${t.jumlah}</td>
            <td class="px-3 py-2">${t.total}</td>
          </tr>`;
      });
    }
  </script>
</body>
</html>
