<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - POS Resto Bunda Ana</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; background:#e0f0ff; color:#333; }
  header { background:#4da6ff; color:#fff; padding:20px; text-align:center; font-size:24px; }
  .container { padding:20px; max-width:1200px; margin:auto; }
  .section { background:#fff; padding:20px; margin-bottom:20px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
  h2 { margin-top:0; color:#0073e6; }
  input, select, button { padding:8px; margin:5px 0; width:100%; box-sizing:border-box; border-radius:5px; border:1px solid #ccc; }
  button { background:#4da6ff; color:#fff; border:none; cursor:pointer; }
  button:hover { background:#3399ff; }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  th, td { border:1px solid #ccc; padding:8px; text-align:left; }
  th { background:#cce0ff; }
  .action-btn { background:#ff6666; }
  .action-btn:hover { background:#ff3333; }
  #loadingOverlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.3); z-index:9999; text-align:center; padding-top:20%; }
  #loadingOverlay div { background:white; padding:20px 40px; border-radius:10px; display:inline-block; font-size:18px; }
  /* Login popup */
  #loginPopup { display:block; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); z-index:10000; text-align:center; padding-top:10%; }
  #loginPopup div { background:#fff; padding:30px; border-radius:10px; width:300px; display:inline-block; text-align:left; }
</style>
</head>
<body>

<header>Admin - POS Resto Bunda Ana</header>

<!-- Loading overlay -->
<div id="loadingOverlay"><div>Loading...</div></div>

<!-- Login Popup -->
<div id="loginPopup">
  <div>
    <h3>Login Admin</h3>
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <button onclick="loginAdmin()">Login</button>
  </div>
</div>

<div class="container" id="adminContent" style="display:none;">

  <button onclick="backToIndex()">Kembali ke Index</button>

  <!-- Section Akun -->
  <div class="section">
    <h2>Manajemen Akun</h2>
    <input type="text" id="newUsername" placeholder="Username">
    <input type="password" id="newPassword" placeholder="Password">
    <select id="newRole">
      <option value="admin">Admin</option>
      <option value="kasir">Kasir</option>
    </select>
    <button onclick="tambahAkun()">Tambah Akun</button>
    <table id="akunTable">
      <thead>
        <tr><th>ID</th><th>Username</th><th>Role</th><th>Aksi</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Section Menu -->
  <div class="section">
    <h2>Manajemen Menu</h2>
    <input type="text" id="newMenu" placeholder="Nama Menu">
    <input type="number" id="newHarga" placeholder="Harga">
    <button onclick="tambahMenu()">Tambah Menu</button>
    <table id="menuTable">
      <thead>
        <tr><th>ID</th><th>Nama Menu</th><th>Harga</th><th>Aksi</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Section Kas & Transaksi -->
  <div class="section">
    <h2>Kas & Transaksi</h2>
    <button onclick="resetKas()">Reset Kas ke 0</button>
    <button onclick="hapusSemuaTransaksi()">Hapus Semua Transaksi</button>
  </div>

</div>

<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.js';

  const SUPABASE_URL = 'https://linujagdxugmocstckmd.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInJlZiOiJzdXBhYmFzZSIsInJlZiI6ImxpbnVqYWdkeHVnbW9jc3Rja21kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY1NDA2NDQsImV4cCI6MjA3MjExNjY0NH0.VWGFS7xy5_f2Iplxqn07HTnfWUIILbRYv4m_RV7YEHI';
  const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  window.supabaseClient = supabaseClient; // Supaya bisa diakses dari fungsi lain

  // Loading overlay
  function showLoading(){ document.getElementById('loadingOverlay').style.display='block'; }
  function hideLoading(){ document.getElementById('loadingOverlay').style.display='none'; }

  function backToIndex(){ window.location.href='index.html'; }

  // =================== LOGIN ===================
  window.loginAdmin = async function(){
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    if(!username || !password){ alert('Isi username & password'); return; }
    showLoading();
    const { data, error } = await supabaseClient.from('akun').select('*').eq('username', username).eq('password', password).eq('role','admin').limit(1);
    hideLoading();
    if(data && data.length>0){
      document.getElementById('loginPopup').style.display='none';
      document.getElementById('adminContent').style.display='block';
      loadAkun(); loadMenu();
    } else {
      alert('Login gagal, pastikan admin benar');
    }
  }

  // =================== AKUN ===================
  window.loadAkun = async function(){
    showLoading();
    const { data, error } = await supabaseClient.from('akun').select('*');
    hideLoading();
    const tbody = document.querySelector('#akunTable tbody');
    tbody.innerHTML='';
    data.forEach(a=>{
      tbody.innerHTML+=`<tr>
        <td>${a.id}</td>
        <td>${a.username}</td>
        <td>${a.role}</td>
        <td><button class="action-btn" onclick="hapusAkun(${a.id})">Hapus</button></td>
      </tr>`;
    });
  }

  window.tambahAkun = async function(){
    const username = document.getElementById('newUsername').value.trim();
    const password = document.getElementById('newPassword').value.trim();
    const role = document.getElementById('newRole').value;
    if(!username || !password){ alert('Isi semua field'); return; }
    if(!confirm('Tambah akun baru?')) return;
    showLoading();
    const { data, error } = await supabaseClient.from('akun').insert([{username,password,role}]);
    hideLoading();
    if(error){ alert('Gagal tambah akun'); } else { alert('Akun berhasil ditambah'); loadAkun(); }
  }

  window.hapusAkun = async function(id){
    if(!confirm('Yakin hapus akun ini?')) return;
    showLoading();
    const { data, error } = await supabaseClient.from('akun').delete().eq('id',id);
    hideLoading();
    if(error){ alert('Gagal hapus akun'); } else { alert('Akun berhasil dihapus'); loadAkun(); }
  }

  // =================== MENU ===================
  window.loadMenu = async function(){
    showLoading();
    const { data, error } = await supabaseClient.from('menu').select('*');
    hideLoading();
    const tbody = document.querySelector('#menuTable tbody');
    tbody.innerHTML='';
    data.forEach(m=>{
      tbody.innerHTML+=`<tr>
        <td>${m.id}</td>
        <td>${m.nama_menu}</td>
        <td>${m.harga}</td>
        <td><button class="action-btn" onclick="hapusMenu(${m.id})">Hapus</button></td>
      </tr>`;
    });
  }

  window.tambahMenu = async function(){
    const nama = document.getElementById('newMenu').value.trim();
    const harga = parseFloat(document.getElementById('newHarga').value);
    if(!nama || isNaN(harga)){ alert('Isi semua field'); return; }
    if(!confirm('Tambah menu baru?')) return;
    showLoading();
    const { data, error } = await supabaseClient.from('menu').insert([{nama_menu:nama,harga}]);
    hideLoading();
    if(error){ alert('Gagal tambah menu'); } else { alert('Menu berhasil ditambah'); loadMenu(); }
  }

  window.hapusMenu = async function(id){
    if(!confirm('Yakin hapus menu ini?')) return;
    showLoading();
    const { data, error } = await supabaseClient.from('menu').delete().eq('id',id);
    hideLoading();
    if(error){ alert('Gagal hapus menu'); } else { alert('Menu berhasil dihapus'); loadMenu(); }
  }

  // =================== KAS & TRANSAKSI ===================
  window.resetKas = async function(){
    if(!confirm('Yakin reset kas ke 0?')) return;
    showLoading();
    await supabaseClient.from('pengeluaran').delete().neq('id',0);
    hideLoading();
    alert('Kas di-reset ke 0');
  }

  window.hapusSemuaTransaksi = async function(){
    if(!confirm('Yakin hapus semua transaksi?')) return;
    showLoading();
    await supabaseClient.from('transaksi_detail').delete().neq('id',0);
    await supabaseClient.from('transaksi').delete().neq('id',0);
    hideLoading();
    alert('Semua transaksi berhasil dihapus');
  }

</script>
</body>
</html>
