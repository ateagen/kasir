<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Halaman Admin</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    .hidden { display: none; }
    .box { background: #fff; padding: 15px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #eee; }
    button { padding: 6px 10px; margin: 3px; }
    #loading { position: fixed; top:0; left:0; right:0; bottom:0;
               background: rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center;
               font-size:18px; color:#fff; }
  </style>
</head>
<body>

  <!-- LOGIN -->
  <div id="loginBox" class="box">
    <h2>Login Admin</h2>
    <input type="text" id="username" placeholder="Username"><br><br>
    <input type="password" id="password" placeholder="Password"><br><br>
    <button onclick="loginAdmin()">Login</button>
  </div>

  <!-- ADMIN DASHBOARD -->
  <div id="adminBox" class="hidden">
    <h2>Dashboard Admin</h2>

    <!-- Kasir -->
    <div class="box">
      <h3>Manajemen Kasir</h3>
      <input type="text" id="kasirUser" placeholder="Username Kasir">
      <input type="password" id="kasirPass" placeholder="Password Kasir">
      <button onclick="addKasir()">Tambah Kasir</button>
      <table id="kasirTable">
        <thead><tr><th>Username</th><th>Aksi</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Menu -->
    <div class="box">
      <h3>Manajemen Menu</h3>
      <input type="text" id="menuName" placeholder="Nama Menu">
      <input type="number" id="menuPrice" placeholder="Harga">
      <button onclick="addMenu()">Tambah Menu</button>
      <table id="menuTable">
        <thead><tr><th>Nama Menu</th><th>Harga</th><th>Aksi</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Transaksi -->
    <div class="box">
      <h3>Transaksi Penjualan</h3>
      <label>Filter tanggal: <input type="date" id="filterDate" onchange="loadTransaksi()"></label>
      <table id="transaksiTable">
        <thead><tr><th>Tanggal</th><th>Jenis</th><th>Kasir</th><th>Menu</th><th>Jumlah</th><th>Total</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- LOADING -->
  <div id="loading" class="hidden">Loading...</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw85obV79pM3htJMLqwdCEF09U5vLA3QX_l8jtmnw-CMFXBd-Dj3uGSNtm07t-PcfjC/exec"; // <-- ganti dengan URL WebApp

function showLoading(show) {
  document.getElementById("loading").classList.toggle("hidden", !show);
}

// ---- LOGIN ----
function loginAdmin() {
  const user = document.getElementById("username").value.trim();
  const pass = document.getElementById("password").value.trim();
  if(user === "admin" && pass === "admin1490"){
    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("adminBox").classList.remove("hidden");
    loadKasir();
    loadMenu();
    loadTransaksi();
  } else {
    alert("Username atau password salah!");
  }
}

// ---- KASIR ----
async function addKasir() {
  const username = document.getElementById("kasirUser").value.trim();
  const password = document.getElementById("kasirPass").value.trim();
  if(!username || !password){ alert("Lengkapi data kasir"); return; }
  showLoading(true);
  try {
    await fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify({ jenis:"Admin", action:"addKasir", username, password }),
      headers: { "Content-Type":"application/json" }
    });
    document.getElementById("kasirUser").value="";
    document.getElementById("kasirPass").value="";
    await loadKasir();
  } catch(err){
    alert("Gagal tambah kasir: "+err);
  }
  showLoading(false);
}

async function deleteKasir(username) {
  showLoading(true);
  await fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({ jenis:"Admin", action:"deleteKasir", username }),
    headers: { "Content-Type":"application/json" }
  });
  await loadKasir();
  showLoading(false);
}

async function loadKasir() {
  const res = await fetch(`${SCRIPT_URL}?jenis=Kasir`);
  const data = await res.json();
  const tbody = document.querySelector("#kasirTable tbody");
  tbody.innerHTML = "";
  if(data.length===0){
    tbody.innerHTML = "<tr><td colspan='2'>Belum ada kasir</td></tr>";
  }
  data.forEach(row => {
    if(row[1]){
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${row[1]}</td>
        <td><button onclick="deleteKasir('${row[1]}')">Hapus</button></td>`;
      tbody.appendChild(tr);
    }
  });
}

// ---- MENU ----
async function addMenu() {
  const namaMenu = document.getElementById("menuName").value.trim();
  const harga = document.getElementById("menuPrice").value.trim();
  if(!namaMenu || !harga){ alert("Lengkapi data menu"); return; }
  showLoading(true);
  try {
    await fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify({ jenis:"Admin", action:"addMenu", namaMenu, harga }),
      headers: { "Content-Type":"application/json" }
    });
    document.getElementById("menuName").value="";
    document.getElementById("menuPrice").value="";
    await loadMenu();
  } catch(err){
    alert("Gagal tambah menu: "+err);
  }
  showLoading(false);
}

async function deleteMenu(namaMenu) {
  showLoading(true);
  await fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({ jenis:"Admin", action:"deleteMenu", namaMenu }),
    headers: { "Content-Type":"application/json" }
  });
  await loadMenu();
  showLoading(false);
}

async function loadMenu() {
  const res = await fetch(`${SCRIPT_URL}?jenis=Menu`);
  const data = await res.json();
  const tbody = document.querySelector("#menuTable tbody");
  tbody.innerHTML = "";
  if(data.length===0){
    tbody.innerHTML = "<tr><td colspan='3'>Belum ada menu</td></tr>";
  }
  data.forEach(row => {
    if(row[4]){
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${row[4]}</td><td>${row[5]}</td>
        <td><button onclick="deleteMenu('${row[4]}')">Hapus</button></td>`;
      tbody.appendChild(tr);
    }
  });
}

// ---- TRANSAKSI ----
async function loadTransaksi() {
  const tanggal = document.getElementById("filterDate").value;
  let url = `${SCRIPT_URL}?jenis=Penjualan`;
  if(tanggal) url += `&tanggal=${tanggal}`;
  const res = await fetch(url);
  const data = await res.json();
  const tbody = document.querySelector("#transaksiTable tbody");
  tbody.innerHTML = "";
  if(data.length===0){
    tbody.innerHTML = "<tr><td colspan='6'>Belum ada transaksi</td></tr>";
  }
  data.forEach(row => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${new Date(row[3]).toLocaleString()}</td>
      <td>${row[0]}</td>
      <td>${row[1]}</td>
      <td>${row[4]}</td>
      <td>${row[6]}</td>
      <td>${row[7]}</td>
    `;
    tbody.appendChild(tr);
  });
}
</script>

</body>
</html>
