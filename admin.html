<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - POS Kasir Bunda Ana</title>
<style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#e6f0ff; color:#333;}
    header { background:#4da6ff; color:#fff; padding:15px; text-align:center; font-size:24px; }
    .container { padding:20px; max-width:1200px; margin:auto;}
    h2 { color:#004080; margin-top:30px; }
    table { width:100%; border-collapse: collapse; margin-top:10px;}
    th, td { border:1px solid #004080; padding:8px; text-align:left;}
    th { background:#99ccff;}
    button { padding:5px 10px; background:#4da6ff; color:#fff; border:none; cursor:pointer; border-radius:4px; }
    button:hover { background:#3399ff; }
    input, select { padding:5px; margin:5px 0; width:100%; max-width:300px; }
    .flex { display:flex; gap:10px; flex-wrap:wrap; }
    .popup-bg { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:none; align-items:center; justify-content:center; z-index:1000;}
    .popup { background:#fff; padding:20px; border-radius:8px; min-width:300px; max-width:90%; }
    .popup h3 { margin-top:0; }
    .close-btn { float:right; cursor:pointer; color:red; font-weight:bold; }
    @media(max-width:768px){ .flex { flex-direction:column; } }
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.27.0/dist/supabase.min.js"></script>
</head>
<body>

<header>Admin - POS Kasir Resto Bunda Ana</header>

<div class="container">

    <!-- Tombol Kembali -->
    <button id="btnBack">Kembali ke Index</button>

    <!-- ===== AKUN ===== -->
    <h2>Manajemen Akun</h2>
    <div class="flex">
        <input type="text" id="akunUsername" placeholder="Username">
        <input type="password" id="akunPassword" placeholder="Password">
        <select id="akunRole">
            <option value="kasir">Kasir</option>
            <option value="admin">Admin</option>
        </select>
        <button id="btnTambahAkun">Tambah Akun</button>
    </div>
    <table id="tabelAkun">
        <thead>
            <tr><th>ID</th><th>Username</th><th>Role</th><th>Aksi</th></tr>
        </thead>
        <tbody></tbody>
    </table>

    <!-- ===== MENU ===== -->
    <h2>Manajemen Menu</h2>
    <div class="flex">
        <input type="text" id="menuNama" placeholder="Nama Menu">
        <input type="number" id="menuHarga" placeholder="Harga">
        <button id="btnTambahMenu">Tambah Menu</button>
    </div>
    <table id="tabelMenu">
        <thead>
            <tr><th>ID</th><th>Nama Menu</th><th>Harga</th><th>Aksi</th></tr>
        </thead>
        <tbody></tbody>
    </table>

    <!-- ===== KAS ===== -->
    <h2>Kas & Transaksi</h2>
    <div class="flex">
        <button id="btnResetKas">Reset Kas ke 0</button>
        <button id="btnHapusTransaksi">Hapus Semua Transaksi</button>
    </div>

</div>

<!-- ===== POPUP LOGIN ===== -->
<div class="popup-bg" id="popupLoginBg">
    <div class="popup">
        <span class="close-btn" id="closeLogin">&times;</span>
        <h3>Login Admin</h3>
        <input type="text" id="loginUsername" placeholder="Username">
        <input type="password" id="loginPassword" placeholder="Password">
        <button id="btnLogin">Login</button>
    </div>
</div>

<script>
const supabaseUrl = 'https://linujagdxugmocstckmd.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxpbnVqYWdkeHVnbW9jc3Rja21kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY1NDA2NDQsImV4cCI6MjA3MjExNjY0NH0.VWGFS7xy5_f2Iplxqn07HTnfWUIILbRYv4m_RV7YEHI';
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

// ===== SESSION MANAGEMENT =====
document.addEventListener("DOMContentLoaded", async () => {
    const sessionAdmin = localStorage.getItem('adminLogin');
    if(!sessionAdmin){
        document.getElementById('popupLoginBg').style.display = 'flex';
    } else {
        loadAkun();
        loadMenu();
    }
});

// Tombol kembali/logout
document.getElementById('btnBack').addEventListener('click', () => {
    localStorage.removeItem('adminLogin');
    window.location.href = 'index.html';
});

// Tutup popup login
document.getElementById('closeLogin').addEventListener('click', () => {
    document.getElementById('popupLoginBg').style.display = 'none';
});

// Login admin
document.getElementById('btnLogin').addEventListener('click', async () => {
    const username = document.getElementById('loginUsername').value;
    const password = document.getElementById('loginPassword').value;
    const { data, error } = await supabase
        .from('akun')
        .select('*')
        .eq('username', username)
        .eq('password', password)
        .eq('role', 'admin')
        .single();

    if(data){
        localStorage.setItem('adminLogin', username);
        document.getElementById('popupLoginBg').style.display = 'none';
        loadAkun();
        loadMenu();
    } else {
        alert('Username/password salah atau bukan admin');
    }
});

// ===== AKUN =====
async function loadAkun(){
    const { data } = await supabase.from('akun').select('*');
    const tbody = document.querySelector('#tabelAkun tbody');
    tbody.innerHTML = '';
    data.forEach(a => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${a.id}</td><td>${a.username}</td><td>${a.role}</td>
            <td><button onclick="hapusAkun(${a.id})">Hapus</button></td>`;
        tbody.appendChild(tr);
    });
}

document.getElementById('btnTambahAkun').addEventListener('click', async () => {
    const username = document.getElementById('akunUsername').value;
    const password = document.getElementById('akunPassword').value;
    const role = document.getElementById('akunRole').value;
    if(!username || !password) { alert('Isi semua field'); return; }

    await supabase.from('akun').insert([{username,password,role}]);
    document.getElementById('akunUsername').value='';
    document.getElementById('akunPassword').value='';
    loadAkun();
});

async function hapusAkun(id){
    if(confirm('Hapus akun ini?')){
        await supabase.from('akun').delete().eq('id', id);
        loadAkun();
    }
}

// ===== MENU =====
async function loadMenu(){
    const { data } = await supabase.from('menu').select('*');
    const tbody = document.querySelector('#tabelMenu tbody');
    tbody.innerHTML = '';
    data.forEach(m => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${m.id}</td><td>${m.nama_menu}</td><td>${m.harga}</td>
            <td><button onclick="hapusMenu(${m.id})">Hapus</button></td>`;
        tbody.appendChild(tr);
    });
}

document.getElementById('btnTambahMenu').addEventListener('click', async () => {
    const nama = document.getElementById('menuNama').value;
    const harga = parseFloat(document.getElementById('menuHarga').value);
    if(!nama || !harga) { alert('Isi semua field'); return; }

    await supabase.from('menu').insert([{nama_menu:nama, harga}]);
    document.getElementById('menuNama').value='';
    document.getElementById('menuHarga').value='';
    loadMenu();
});

async function hapusMenu(id){
    if(confirm('Hapus menu ini?')){
        await supabase.from('menu').delete().eq('id', id);
        loadMenu();
    }
}

// ===== KAS & TRANSAKSI =====
document.getElementById('btnResetKas').addEventListener('click', async () => {
    if(confirm('Reset kas ke 0?')){
        await supabase.from('kas').delete(); // hapus semua kas
        alert('Kas berhasil di-reset');
    }
});

document.getElementById('btnHapusTransaksi').addEventListener('click', async () => {
    if(confirm('Hapus semua transaksi?')){
        await supabase.from('transaksi').delete();
        await supabase.from('transaksi_detail').delete();
        alert('Semua transaksi berhasil dihapus');
    }
});
</script>

</body>
</html>
